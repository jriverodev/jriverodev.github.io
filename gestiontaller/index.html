<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reporte Taller Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body class="bg-slate-100 min-h-screen pb-10">

    <nav class="bg-blue-900 text-white p-4 shadow-xl sticky top-0 z-50">
        <h1 class="text-center font-bold">REPORTE DIARIO DE MANTENIMIENTO</h1>
    </nav>

    <main class="max-w-2xl mx-auto p-4 space-y-6">
        
        <div class="bg-white p-5 rounded-xl shadow-md border-t-4 border-blue-600">
            <h2 class="font-bold text-blue-900 mb-4"><i class="bi bi-geo-alt-fill"></i> Configuraci√≥n del Reporte</h2>
            <div class="grid grid-cols-1 gap-4">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase">Seleccionar Taller</label>
                    <select id="taller_sel" class="w-full p-2 bg-gray-50 border rounded-lg font-semibold">
                        <option>Taller de Mantenimiento Lagunillas Flota Pesada</option>
                        <option>Taller de Mantenimiento Lagunillas Flota Liviana</option>
                        <option>Taller de Mantenimiento La Salina Flota Pesada</option>
                        <option>Taller de Mantenimiento La Salina Flota Liviana</option>
                        <option>Taller de Mantenimiento Lago Medio Flota Pesada</option>
                        <option>Taller de Mantenimiento Lago Medio Flota Liviana</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase">Fecha del Reporte</label>
                    <input type="date" id="fecha_rep" class="w-full p-2 bg-gray-50 border rounded-lg">
                </div>
            </div>
        </div>

        <div class="bg-white p-5 rounded-xl shadow-md border-t-4 border-orange-500">
            <h2 class="font-bold text-orange-900 mb-4"><i class="bi bi-truck"></i> Registrar Unidad Atendida</h2>
            <div class="space-y-3">
                <input type="text" id="u_nombre" placeholder="Ej: Unidad Cami√≥n Cava 1700" class="w-full p-2 border rounded-lg">
                <textarea id="u_accion" placeholder="Acciones tomadas..." class="w-full p-2 border rounded-lg text-sm" rows="3"></textarea>
                <div class="grid grid-cols-2 gap-2">
                    <select id="u_estatus" class="p-2 border rounded-lg font-bold text-sm">
                        <option value="OPERATIVO" class="text-green-600">‚úÖ OPERATIVO</option>
                        <option value="INOPERATIVO" class="text-red-600">‚ùé INOPERATIVO</option>
                        <option value="RECUPERACION" class="text-orange-600">üõ†Ô∏è EN RECUPERACI√ìN</option>
                    </select>
                    <button onclick="agregarUnidad()" class="bg-orange-500 text-white font-bold rounded-lg hover:bg-orange-600 transition">
                        + AGREGAR
                    </button>
                </div>
            </div>
        </div>

        <div class="bg-white p-5 rounded-xl shadow-md">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-bold text-gray-700">Unidades en este reporte: <span id="cont_total" class="text-blue-600">0</span></h2>
                <button onclick="limpiarTodo()" class="text-xs text-red-500 underline">Borrar todo</button>
            </div>
            <div id="lista_unidades" class="space-y-3 max-h-80 overflow-y-auto">
                <p class="text-gray-400 text-center text-sm">No hay unidades registradas hoy.</p>
            </div>
        </div>

        <button onclick="exportarWhatsApp()" class="w-full bg-green-600 text-white py-4 rounded-2xl font-bold shadow-lg hover:bg-green-700 flex justify-center items-center gap-3 transition-all transform active:scale-95">
            <i class="bi bi-whatsapp text-2xl"></i> GENERAR Y ENVIAR REPORTE
        </button>

    </main>

    <script>
        let unidadesLog = [];

        window.onload = () => {
            document.getElementById('fecha_rep').valueAsDate = new Date();
        };

        function agregarUnidad() {
            const nombre = document.getElementById('u_nombre').value;
            const accion = document.getElementById('u_accion').value;
            const estatus = document.getElementById('u_estatus').value;

            if(!nombre || !accion) return alert("Por favor rellena los datos de la unidad");

            unidadesLog.push({ nombre, accion, estatus });
            
            // Limpiar campos
            document.getElementById('u_nombre').value = "";
            document.getElementById('u_accion').value = "";
            
            renderLista();
        }

        function renderLista() {
            const cont = document.getElementById('lista_unidades');
            const total = document.getElementById('cont_total');
            total.innerText = unidadesLog.length;

            if(unidadesLog.length === 0) {
                cont.innerHTML = `<p class="text-gray-400 text-center text-sm">No hay unidades registradas hoy.</p>`;
                return;
            }

            cont.innerHTML = unidadesLog.map((u, index) => `
                <div class="p-3 bg-slate-50 border rounded-lg relative">
                    <button onclick="eliminar(${index})" class="absolute top-2 right-2 text-red-400"><i class="bi bi-trash"></i></button>
                    <p class="font-bold text-sm text-blue-800">${u.nombre}</p>
                    <p class="text-xs text-gray-600">${u.accion}</p>
                    <span class="text-[10px] font-bold ${u.estatus === 'OPERATIVO' ? 'text-green-600' : 'text-red-600'}">${u.estatus}</span>
                </div>
            `).join('');
        }

        function eliminar(idx) {
            unidadesLog.splice(idx, 1);
            renderLista();
        }

        function limpiarTodo() {
            if(confirm("¬øSeguro que quieres borrar la lista actual?")) {
                unidadesLog = [];
                renderLista();
            }
        }

        function exportarWhatsApp() {
            if(unidadesLog.length === 0) return alert("Agrega al menos una unidad");

            const taller = document.getElementById('taller_sel').value;
            const fecha = document.getElementById('fecha_rep').value.split('-').reverse().join('/');
            
            // C√°lculos autom√°ticos
            const operativos = unidadesLog.filter(u => u.estatus === 'OPERATIVO').length;
            const inoperativos = unidadesLog.filter(u => u.estatus === 'INOPERATIVO' || u.estatus === 'RECUPERACION').length;
            const recuperacion = unidadesLog.filter(u => u.estatus === 'RECUPERACION');

            let texto = `*REPORTE INFORMATIVO*\n`;
            texto += `*Regi√≥n/Negocio/Filial:* Cuenca Occidente\n`;
            texto += `*Gerencia:* Transporte Terrestre\n`;
            texto += `*Estado:* Zulia\n`;
            texto += `*Lugar:* ${taller}\n`;
            texto += `*Fecha:* ${fecha}\n`;
            texto += `*Hora:* 7:00AM - 04:00PM\n`;
            texto += `*Asunto:* Reporte Diario ${taller}.\n\n`;
            
            texto += `*Resumen:*\n\n`;
            texto += `üö® *Total de unidades atendidas con ODM:* ${unidadesLog.length}\n`;
            texto += `üèõÔ∏è ${taller}: ${unidadesLog.length}\n\n`;
            
            texto += `üö® *Detalle de Mantenimientos:*\n\n`;
            texto += `üìå Correctivos: ${unidadesLog.length}\n`; // Se asume correctivo por defecto en este flujo
            texto += `üìå Preventivos: 00\n\n`;
            
            texto += `üö® *Condiciones:*\n`;
            texto += `‚úÖ Operativos: ${operativos}\n`;
            texto += `‚ùé Fuera de Servicio: ${inoperativos}\n\n`;

            texto += `*Acciones Tomadas:*\n\n`;

            unidadesLog.filter(u => u.estatus !== 'RECUPERACION').forEach(u => {
                texto += `*Unidad ${u.nombre}:*\n${u.accion}\n${u.estatus}.\n\n`;
            });

            if(recuperacion.length > 0) {
                texto += `*UNIDADES EN PROCESO DE RECUPERACI√ìN:*\n\n`;
                recuperacion.forEach(u => {
                    texto += `*Unidad ${u.nombre}*\n${u.accion}\nINOPERATIVO.\n\n`;
                });
            }

            texto += `*Fuente:* Taller de Mantenimiento Transporte Terrestre Lagunillas Flota Pesada.`;

            window.open(`https://wa.me/?text=${encodeURIComponent(texto)}`, '_blank');
        }
    </script>
</body>
</html>
