<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RCT Ultra Pixel Art: Full Graphics</title>
    <style>
        body { 
            display: flex; flex-direction: column; align-items: center; 
            background: #1a1a1a; color: white; font-family: 'Courier New', Courier, monospace; 
            margin: 0; padding: 10px; touch-action: none; overflow: hidden;
        }
        #header {
            width: 95vw; max-width: 450px; background: #222; padding: 10px; 
            border-radius: 8px; margin-bottom: 5px; border-bottom: 3px solid #f1c40f;
        }
        .stats-row { display: flex; justify-content: space-between; font-size: 14px; }
        #aiStatus { background: #333; padding: 5px; font-size: 10px; color: #0f0; margin-top: 5px; border-radius: 3px; display: flex; align-items: center; justify-content: space-between; }
        #speakerBtn { background: none; border: none; font-size: 18px; cursor: pointer; color: #0f0; }
        canvas { 
            border: 4px solid #3d3d3d; background: #2d7d32; 
            width: 95vw; height: 95vw; max-width: 450px; max-height: 450px;
            image-rendering: pixelated; 
        }
        .ui { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; 
            width: 95vw; max-width: 450px; margin-top: 10px; 
        }
        button { 
            padding: 8px 2px; font-size: 9px; border: none; cursor: pointer;
            border-radius: 4px; color: white; font-weight: bold; text-transform: uppercase;
        }
        .active { background: #f1c40f !important; color: #000; }
        .btn-mode { background: #444; }
        .btn-blue { background: #3498db; }
        .btn-green { background: #2ecc71; grid-column: span 3; padding: 12px; margin-top: 5px; }
    </style>
</head>
<body>

    <div id="header">
        <div class="stats-row">
            <div>üí∞ <span id="moneyTxt">$500</span></div>
            <div>üòä <span id="happyTxt">100%</span></div>
        </div>
        <div id="aiStatus">
            <span id="aiAdviceText">SISTEMA VISUAL COMPLETO</span>
            <button id="speakerBtn" onclick="toggleSpeaker()">üîä</button>
        </div>
    </div>

    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <div class="ui">
        <button id="btnCamino" class="active" onclick="setMode('camino')">V√≠a</button>
        <button id="btnFeria" class="btn-mode" onclick="setMode('feria')">üé° Feria</button>
        <button id="btnComida" class="btn-mode" onclick="setMode('comida')">üçî Comida</button>
        <button id="btnPapelera" class="btn-mode" onclick="setMode('papelera')">üóëÔ∏è Papelera</button>
        <button id="btnBanco" class="btn-mode" onclick="setMode('banco')">üí∫ Banco</button>
        <button class="btn-blue" onclick="hireStaff()">Limpiador üßπ</button>
        <button class="btn-green" onclick="spawnPeeps(1)">NUEVO VISITANTE üë§</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const TILE_SIZE = 40;
        const COLS = 10, ROWS = 10;

        let grid = Array(COLS).fill().map(() => Array(ROWS).fill(0));
        let trash = [], buildings = [], peeps = [], staff = [], footprints = [];
        let wallet = 500, felicidad = 100, currentMode = 'camino';
        let speakerEnabled = true;

        const synth = window.speechSynthesis;
        function speak(text) { if(speakerEnabled) { const u = new SpeechSynthesisUtterance(text); u.lang='es-ES'; synth.speak(u); } }
        function toggleSpeaker() { speakerEnabled = !speakerEnabled; document.getElementById('speakerBtn').innerText = speakerEnabled ? 'üîä' : 'üîá'; }

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.ui button').forEach(b => b.classList.remove('active'));
            const btnId = 'btn' + mode.charAt(0).toUpperCase() + mode.slice(1);
            if(document.getElementById(btnId)) document.getElementById(btnId).classList.add('active');
        }

        // --- DIBUJO DE EDIFICIOS PIXEL ART ---
        function drawBuilding(type, x, y) {
            ctx.save();
            ctx.translate(x * TILE_SIZE, y * TILE_SIZE);
            ctx.fillStyle = "#000"; // Borde base
            
            if(type === 'feria') {
                ctx.fillRect(5, 5, 30, 30); // Estructura
                ctx.fillStyle = "#e74c3c"; ctx.fillRect(6, 6, 28, 28); // Rojo
                ctx.fillStyle = "#f1c40f"; ctx.fillRect(15, 15, 10, 10); // Centro
                ctx.fillStyle = "#fff"; ctx.fillRect(18, 10, 4, 20); ctx.fillRect(10, 18, 20, 4); // Aspas
            } else if(type === 'comida') {
                ctx.fillRect(5, 15, 30, 20); // Puesto
                ctx.fillStyle = "#d35400"; ctx.fillRect(6, 16, 28, 18); // Madera
                ctx.fillStyle = "#f39c12"; ctx.fillRect(10, 10, 20, 6); // Techo
                ctx.fillStyle = "#fff"; ctx.fillRect(12, 20, 5, 5); // Ventana
            } else if(type === 'papelera') {
                ctx.fillRect(12, 10, 16, 25);
                ctx.fillStyle = "#7f8c8d"; ctx.fillRect(13, 11, 14, 23); // Metal
                ctx.fillStyle = "#2c3e50"; ctx.fillRect(15, 15, 10, 3); // Boca
            } else if(type === 'banco') {
                ctx.fillRect(5, 20, 30, 15);
                ctx.fillStyle = "#27ae60"; ctx.fillRect(6, 21, 28, 13); // Asiento
                ctx.fillStyle = "#000"; ctx.fillRect(8, 25, 24, 2); // Detalle
            }
            ctx.restore();
        }

        class Agent {
            constructor(x, y, isStaff = false) {
                this.gridX = x; this.gridY = y;
                this.pixelX = x * TILE_SIZE + TILE_SIZE/2;
                this.pixelY = y * TILE_SIZE + TILE_SIZE/2;
                this.targetGridX = x; this.targetGridY = y;
                this.isMoving = false;
                this.isStaff = isStaff;
                this.shirtColor = isStaff ? "#2980b9" : `hsl(${Math.random()*360}, 60%, 50%)`;
                this.anim = 0; this.dir = 1;
            }

            update() {
                if (!this.isMoving) this.think(); else this.move();
                this.draw();
            }

            think() {
                const dirs = [{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}].sort(()=>Math.random()-0.5);
                for(let d of dirs) {
                    let nX = this.gridX + d.x, nY = this.gridY + d.y;
                    if(nX>=0 && nX<COLS && nY>=0 && nY<ROWS && grid[nX][nY] === 1) {
                        this.targetGridX = nX; this.targetGridY = nY;
                        this.isMoving = true; this.dir = d.x !== 0 ? d.x : this.dir;
                        break;
                    }
                }
            }

            move() {
                const tx = this.targetGridX * TILE_SIZE + TILE_SIZE/2;
                const ty = this.targetGridY * TILE_SIZE + TILE_SIZE/2;
                this.pixelX += (tx - this.pixelX) * 0.12;
                this.pixelY += (ty - this.pixelY) * 0.12;
                this.anim += 0.25;
                
                if (!this.isStaff && trash.some(t => t.x === this.gridX && t.y === this.gridY)) {
                    if (Math.random() > 0.8) footprints.push({x: this.pixelX, y: this.pixelY + 5, life: 150});
                }

                if(Math.abs(tx - this.pixelX) < 1 && Math.abs(ty - this.pixelY) < 1) {
                    this.gridX = this.targetGridX; this.gridY = this.targetGridY;
                    this.isMoving = false;
                    if(this.isStaff) {
                        trash = trash.filter(t => !(t.x === this.gridX && t.y === this.gridY));
                        footprints = footprints.filter(f => Math.hypot(f.x - this.pixelX, f.y - this.pixelY) > 15);
                    }
                }
            }

            draw() {
                ctx.save();
                ctx.translate(this.pixelX, this.pixelY);
                ctx.scale(this.dir, 1);
                const step = Math.sin(this.anim) * 3;

                // CABEZA
                ctx.fillStyle = "#000"; ctx.fillRect(-7, -22, 14, 14);
                ctx.fillStyle = "#ffdbac"; ctx.fillRect(-6, -21, 12, 12);
                ctx.fillStyle = "#000"; ctx.fillRect(2, -17, 2, 2);

                // CUERPO
                ctx.fillStyle = "#000"; ctx.fillRect(-8, -9, 16, 12);
                ctx.fillStyle = this.shirtColor; ctx.fillRect(-7, -8, 14, 10);

                // PIERNAS
                ctx.fillStyle = "#000";
                ctx.fillRect(-6, 2 - step, 5, 7); 
                ctx.fillRect(1, 2 - (3-step), 5, 7);
                ctx.restore();
            }
        }

        function handleInput(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            const x = Math.floor(((clientX - rect.left) * (400/rect.width)) / TILE_SIZE);
            const y = Math.floor(((clientY - rect.top) * (400/rect.height)) / TILE_SIZE);

            if(currentMode === 'camino') {
                if(grid[x][y] === 0 && wallet >= 10) { grid[x][y] = 1; wallet -= 10; }
            } else {
                let cost = currentMode === 'feria' ? 150 : (currentMode === 'comida' ? 80 : 30);
                if(wallet >= cost) { buildings.push({x, y, type: currentMode}); wallet -= cost; }
            }
            updateUI();
        }

        canvas.addEventListener('mousedown', handleInput);
        canvas.addEventListener('touchstart', (e)=>{e.preventDefault(); handleInput(e);});

        function spawnPeeps(n) { for(let i=0; i<n; i++) peeps.push(new Agent(0,0)); speak("Visitante atra√≠do"); }
        function hireStaff() { if(wallet>=50){ wallet-=50; staff.push(new Agent(0,0,true)); speak("Personal contratado"); } }

        function updateUI() {
            document.getElementById('moneyTxt').innerText = `$${Math.floor(wallet)}`;
            felicidad = Math.max(0, 100 - (trash.length * 5) - (footprints.length * 0.3));
            document.getElementById('happyTxt').innerText = `${Math.floor(felicidad)}%`;
        }

        function loop() {
            ctx.clearRect(0,0,400,400);
            ctx.fillStyle = "#2d7d32"; ctx.fillRect(0,0,400,400);

            for(let x=0;x<COLS;x++) for(let y=0;y<ROWS;y++) {
                if(grid[x][y]===1) { ctx.fillStyle="#888"; ctx.fillRect(x*TILE_SIZE, y*TILE_SIZE, TILE_SIZE, TILE_SIZE); }
            }

            footprints.forEach((f, i) => {
                ctx.fillStyle = `rgba(0,0,0,${f.life/150})`; ctx.fillRect(f.x-2, f.y, 4, 2);
                f.life--; if(f.life<=0) footprints.splice(i,1);
            });

            buildings.forEach(b => drawBuilding(b.type, b.x, b.y));
            trash.forEach(t => { ctx.font="16px Arial"; ctx.fillText(t.type, t.x*TILE_SIZE+10, t.y*TILE_SIZE+25); });
            peeps.forEach(p => p.update());
            staff.forEach(s => s.update());
            
            updateUI();
            requestAnimationFrame(loop);
        }
        loop();

        setInterval(() => {
            if(peeps.length > 0 && Math.random() > 0.6) {
                let p = peeps[Math.floor(Math.random()*peeps.length)];
                trash.push({x: p.gridX, y: p.gridY, type: Math.random()>0.8?'ü§Æ':'ü•§'});
            }
        }, 5000);
    </script>
</body>
</html>
