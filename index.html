<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Inventario</title>

    <meta name="theme-color" content="#2c3e50"/>
    <meta name="description" content="Sistema de Gesti√≥n de Inventario - PWA">
    
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjE5MiIgaGVpZ2h0PSIxOTIiIC8+
    <meta name="apple-mobile-web-app-status-bar" content="#2c3e50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* Estilos CSS para la interfaz del sistema */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .nav {
            display: flex;
            background: #34495e;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }

        .nav button {
            flex: 1;
            padding: 15px;
            border: none;
            background: #34495e;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
            font-size: 14px;
            min-width: 120px;
        }

        .nav button:hover {
            background: #2c3e50;
        }

        .nav button.active {
            background: #3498db;
            font-weight: bold;
        }

        .content {
            padding: 20px;
            min-height: 400px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .search-box {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .search-box input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background: #34495e;
            color: white;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 2px;
            font-size: 12px;
            transition: all 0.3s;
        }

        .btn-edit {
            background: #f39c12;
            color: white;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-add {
            background: #27ae60;
            color: white;
            padding: 10px 20px;
            margin-bottom: 15px;
        }

        .btn-export {
            background: #9b59b6;
            color: white;
        }

        .btn-import {
            background: #e67e22;
            color: white;
        }

        .btn-download-template {
            background: #34495e;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            font-size: 16px;
        }

        .form-actions {
            text-align: right;
            margin-top: 20px;
        }

        .btn-cancel {
            background: #95a5a6;
            color: white;
        }

        .btn-save {
            background: #3498db;
            color: white;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 10px 20px;
            background: #e67e22;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        .import-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .equipment-info {
            background: #e8f4fd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
        }

        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
            }
            
            .nav button {
                padding: 12px;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            th, td {
                padding: 8px;
                font-size: 14px;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 11px;
            }

            .header-actions {
                flex-direction: column;
                align-items: center;
            }
        }

        .footer {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            color: #666;
            border-top: 1px solid #e9ecef;
        }

        .status-operativo {
            color: #27ae60;
            font-weight: bold;
        }

        .status-inoperativo {
            color: #e74c3c;
            font-weight: bold;
        }

        .assigned-badge {
            background: #27ae60;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
        }

        .unassigned-badge {
            background: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
        }

        /* ... (TODOS TUS ESTILOS ACTUALES SE MANTIENEN) ... */

        /* === ESTILOS PWA ADICIONALES === */
        .pwa-install-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            font-size: 14px;
        }

        .pwa-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(44, 62, 80, 0.9);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            z-index: 1000;
        }

        .offline-warning {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #e74c3c;
            color: white;
            text-align: center;
            padding: 10px;
            z-index: 1001;
            display: none;
        }

        @media (max-width: 768px) {
            .pwa-install-btn {
                bottom: 10px;
                right: 10px;
                padding: 10px 15px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="offline-warning" id="offlineWarning">
        ‚ö†Ô∏è Est√°s trabajando sin conexi√≥n
    </div>
    
    <div class="pwa-status" id="pwaStatus">
        üì± PWA Lista
    </div>
    
    <button class="pwa-install-btn" id="pwaInstallBtn">
        üì≤ Instalar App
    </button>
    
    <div class="container">
        <div class="header">
            <h1>üì± Sistema de Inventario</h1>
            <p>Gesti√≥n completa de inventario</p>
            <div class="header-actions">
                <button class="btn btn-export" onclick="exportToExcel()">üìä Exportar a Excel</button>
                </div>
        </div>

        <div class="nav">
            <button onclick="showTab('dashboard')" class="active">üìä Dashboard</button>
            <button onclick="showTab('usuarios')">üë• Usuarios</button>
            <button onclick="showTab('equipos')">üíª Equipos</button>
            <button onclick="showTab('asignaciones')">üîó Asignaciones</button>
        </div>

        <div class="content">
            <div id="dashboard" class="tab-content active">
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsuarios">0</div>
                        <div class="stat-label">Total Usuarios</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalEquipos">0</div>
                        <div class="stat-label">Total Equipos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="equiposOperativos">0</div>
                        <div class="stat-label">Equipos Operativos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="equiposAsignados">0</div>
                        <div class="stat-label">Equipos Asignados</div>
                    </div>
                </div>

                <div class="search-box">
                    <input type="text" id="globalSearch" placeholder="üîç Buscar en todo el inventario..." onkeyup="globalSearch()">
                </div>

                <h3>√öltimas Asignaciones</h3>
                <div id="ultimasAsignaciones" class="table-container">
                    </div>
            </div>

            <div id="usuarios" class="tab-content">
                <button class="btn btn-add" onclick="openUserModal()">‚ûï Agregar Usuario</button>
                <div class="search-box">
                    <input type="text" id="searchUsuarios" placeholder="üîç Buscar usuarios..." onkeyup="filterTable('usuarios')">
                </div>
                <div class="table-container">
                    <table id="tablaUsuarios">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Responsable</th>
                                <th>C√©dula</th>
                                <th>Cargo</th>
                                <th>Sector</th>
                                <th>Equipos Asignados</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyUsuarios">
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="equipos" class="tab-content">
                <button class="btn btn-add" onclick="openEquipmentModal()">‚ûï Agregar Equipo</button>
                <div class="search-box">
                    <input type="text" id="searchEquipos" placeholder="üîç Buscar equipos..." onkeyup="filterTable('equipos')">
                </div>
                <div class="table-container">
                    <table id="tablaEquipos">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Descripci√≥n</th>
                                <th>Marca</th>
                                <th>Modelo</th>
                                <th>Serial</th>
                                <th>Status</th>
                                <th>Asignado a</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyEquipos">
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="asignaciones" class="tab-content">
                <button class="btn btn-add" onclick="openAssignmentModal()">‚ûï Nueva Asignaci√≥n</button>
                <div class="search-box">
                    <input type="text" id="searchAsignaciones" placeholder="üîç Buscar asignaciones..." onkeyup="filterTable('asignaciones')">
                </div>
                <div class="table-container">
                    <table id="tablaAsignaciones">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Usuario</th>
                                <th>Equipo</th>
                                <th>Serial Equipo</th>
                                <th>Fecha</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyAsignaciones">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Sistema de Inventario - RIVEROJDU</p>
        </div>
    </div>

    <div id="userModal" class="modal">
        <div class="modal-content">
            <h3 id="userModalTitle">Agregar Usuario</h3>
            <form id="userForm">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label>Responsable:</label>
                    <input type="text" id="responsable" required>
                </div>
                <div class="form-group">
                    <label>C√©dula:</label>
                    <input type="text" id="cedula">
                </div>
                <div class="form-group">
                    <label>Cargo:</label>
                    <input type="text" id="cargo">
                </div>
                <div class="form-group">
                    <label>Sector:</label>
                    <input type="text" id="sector" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeUserModal()">Cancelar</button>
                    <button type="submit" class="btn btn-save">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="equipmentModal" class="modal">
        <div class="modal-content">
            <h3 id="equipmentModalTitle">Agregar Equipo</h3>
            <form id="equipmentForm">
                <input type="hidden" id="equipmentId">
                <div class="form-group">
                    <label>Descripci√≥n:</label>
                    <input type="text" id="descripcion" required>
                </div>
                <div class="form-group">
                    <label>Marca:</label>
                    <input type="text" id="marca" required>
                </div>
                <div class="form-group">
                    <label>Modelo:</label>
                    <input type="text" id="modelo" required>
                </div>
                <div class="form-group">
                    <label>Serial: <small>(√önico, identifica el equipo)</small></label>
                    <input type="text" id="serial" required>
                </div>
                <div class="form-group">
                    <label>Etiqueta:</label>
                    <input type="text" id="etiqueta">
                </div>
                <div class="form-group">
                    <label>Status:</label>
                    <select id="status" required>
                        <option value="OPERATIVO">OPERATIVO</option>
                        <option value="INOPERATIVO">INOPERATIVO</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Observaciones:</label>
                    <textarea id="observaciones" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeEquipmentModal()">Cancelar</button>
                    <button type="submit" class="btn btn-save">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="assignmentModal" class="modal">
        <div class="modal-content">
            <h3 id="assignmentModalTitle">Nueva Asignaci√≥n</h3>
            <form id="assignmentForm">
                <input type="hidden" id="assignmentId">
                <div class="form-group">
                    <label>Usuario:</label>
                    <select id="assignmentUsuario" required onchange="updateAvailableEquipments()">
                        <option value="">Seleccionar usuario</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Equipo:</label>
                    <select id="assignmentEquipo" required onchange="updateEquipmentDetails()">
                        <option value="">Seleccionar equipo</option>
                    </select>
                    <div id="equipmentDetails" class="equipment-info" style="display: none;">
                        </div>
                </div>
                <div class="form-group">
                    <label>Estado:</label>
                    <select id="assignmentEstado" required>
                        <option value="Asignado">Asignado</option>
                        <option value="Retirado">Retirado</option>
                        <option value="En Reparaci√≥n">En Reparaci√≥n</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeAssignmentModal()">Cancelar</button>
                    <button type="submit" class="btn btn-save">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
  // =============================================
// CONFIGURACI√ìN PWA PARA GITHUB PAGES
// =============================================

// Manifest din√°mico para PWA
// =============================================
// CONFIGURACI√ìN PWA CON TUS ICONOS PNG
// =============================================

const manifest = {
    "name": "Sistema de Inventario",
    "short_name": "InventarioPWA", 
    "description": "Sistema de gesti√≥n de inventario completo con usuarios, equipos y asignaciones",
    "start_url": ".",
    "scope": "/",
    "display": "standalone",
    "background_color": "#ffffff",
    "theme_color": "#2c3e50",
    "orientation": "any",
    "categories": ["business", "productivity", "utilities"],
    "icons": [
        {
            "src": "content/icons/android/android-launchericon-192-192.png",
            "sizes": "192x192",
            "type": "image/png",
            "purpose": "any"
        },
        {
            "src": "content/icons/android/android-launchericon-512-512.png",
            "sizes": "512x512",
            "type": "image/png",
            "purpose": "any"
        }
    ],
    "screenshots": [
        {
            "src": "content/icons/windows11/Wide310x150Logo.scale-400.png",
            "sizes": "1240x600",
            "type": "image/png",
            "form_factor": "wide",
            "label": "Dashboard del Sistema de Inventario"
        }
    ]
};

// Crear y agregar manifest din√°mico
function setupPWA() {
    // Crear link del manifest
    const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
    const manifestURL = URL.createObjectURL(manifestBlob);
    
    const manifestLink = document.createElement('link');
    manifestLink.rel = 'manifest';
    manifestLink.href = manifestURL;
    document.head.appendChild(manifestLink);

    console.log('‚úÖ Manifest PWA configurado');

    // En GitHub Pages usamos un enfoque simplificado sin Service Worker
    setupPWAInstall();
    setupConnectionDetection();
    
    // Marcar como PWA b√°sica (sin Service Worker)
    updatePWAStatus('‚úÖ PWA B√°sica');
}

// Service Worker ALTERNATIVO - Solo para HTTPS tradicional
function tryRegisterServiceWorker() {
    // Solo intentar en entornos que soporten Service Workers correctamente
    if ('serviceWorker' in navigator && location.protocol === 'https:') {
        try {
            // Intentar registrar un Service Worker muy b√°sico
            const swContent = `
                self.addEventListener('install', (event) => {
                    console.log('üì¶ PWA Installado');
                    self.skipWaiting();
                });
                
                self.addEventListener('activate', (event) => {
                    console.log('‚úÖ PWA Activado');
                    event.waitUntil(self.clients.claim());
                });
                
                // Cache b√°sico para recursos cr√≠ticos
                self.addEventListener('fetch', (event) => {
                    // Estrategia de cache b√°sica
                    event.respondWith(
                        caches.match(event.request)
                            .then(response => response || fetch(event.request))
                    );
                });
            `;
        }