<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CV Studio Pro</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='25' fill='%23007AFF'/><path d='M30 35h40M30 50h40M30 65h25' stroke='white' stroke-width='8' stroke-linecap='round'/></svg>">
    <link rel="manifest" id="pwa-manifest">

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root { --primary: #007AFF; --dark: #1C1C1E; --bg: #F2F2F7; --card: #FFFFFF; }
        * { box-sizing: border-box; font-family: -apple-system, system-ui, sans-serif; }
        
        body { background-color: var(--bg); margin: 0; padding: 20px; color: var(--dark); display: flex; justify-content: center; }
        
        .app-container { width: 100%; max-width: 600px; }
        
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-weight: 800; font-size: 2rem; margin: 0; color: var(--primary); }
        .header p { color: #8E8E93; margin-top: 5px; }

        .card { 
            background: var(--card); border-radius: 20px; padding: 24px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 20px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .card h3 { margin-top: 0; font-size: 1.1rem; border-bottom: 2px solid #F2F2F7; padding-bottom: 10px; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }

        input, textarea, select { 
            width: 100%; padding: 14px; margin: 8px 0; border: 1.5px solid #E5E5EA; 
            border-radius: 12px; font-size: 16px; transition: 0.2s; background: #F9F9FB;
        }
        input:focus { border-color: var(--primary); outline: none; background: #FFF; }

        .btn-add { 
            background: #F2F2F7; color: var(--primary); border: 2px dashed #D1D1D6; 
            width: 100%; padding: 12px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: 0.3s;
        }
        .btn-add:hover { background: #E5E5EA; }

        .item-row { 
            background: #F9F9FB; padding: 12px; border-radius: 12px; 
            display: flex; justify-content: space-between; align-items: center; margin: 8px 0;
            border-left: 4px solid var(--primary);
        }

        .delete-btn { color: #FF3B30; font-weight: bold; cursor: pointer; padding: 5px; }

        .footer-actions { 
            position: sticky; bottom: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px; 
            background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); padding: 15px; border-radius: 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
        }

        .btn-main { background: var(--primary); color: white; border: none; padding: 16px; border-radius: 14px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(0,122,255,0.3); }
        .btn-pdf { background: var(--dark); }
        
        /* Animaciones para los items */
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h1>CV Studio</h1>
        <p>Crea un curr√≠culum de alto impacto</p>
    </div>

    <div class="card fade-in">
        <h3>üë§ Informaci√≥n Personal</h3>
        <input type="text" id="nombre" placeholder="Nombre Completo (Ej: JUAN P√âREZ)">
        <input type="text" id="cargo" placeholder="Tu Especialidad (Ej: GERENTE OPERATIVO)">
        <div style="display: grid; grid-template-columns: 1fr; gap: 5px;">
            <input type="text" id="telefono" placeholder="üì± Tel√©fono">
            <input type="text" id="ubicacion" placeholder="üìç Ciudad, Pa√≠s">
            <input type="text" id="email" placeholder="‚úâÔ∏è Correo electr√≥nico">
        </div>
    </div>

    <div class="card fade-in">
        <h3>üìù Resumen Profesional</h3>
        <textarea id="perfil" rows="4" placeholder="Cu√©ntanos qui√©n eres y qu√© aportas..."></textarea>
    </div>

    <div class="card fade-in">
        <h3>üíº Experiencia Laboral</h3>
        <div id="lista-exp"></div>
        <button class="btn-add" onclick="modalExp()">+ A√±adir Trayectoria</button>
    </div>

    <div class="card fade-in">
        <h3>üéì Formaci√≥n Acad√©mica</h3>
        <div id="lista-edu"></div>
        <button class="btn-add" onclick="modalEdu()">+ A√±adir Estudios</button>
    </div>

    <div class="card fade-in">
        <h3>üåç Idiomas</h3>
        <div id="lista-idioma"></div>
        <button class="btn-add" onclick="modalIdioma()">+ A√±adir Idioma</button>
    </div>

    <div class="card fade-in">
        <h3>üõ†Ô∏è Habilidades T√©cnicas</h3>
        <input type="text" id="habilidades" placeholder="Ej: Office, Liderazgo, CRM (Separa con comas)">
    </div>

    <div class="footer-actions">
        <button class="btn-main" onclick="generarWord()">Descargar Word</button>
        <button class="btn-main btn-pdf" onclick="generarPDF()">Exportar PDF</button>
    </div>
</div>

<script>
    let cv = { exp: [], edu: [], idio: [] };

    // Modales amigables con SweetAlert2
    async function modalExp() {
        const { value: v } = await Swal.fire({
            title: 'A√±adir Experiencia',
            html: `
                <input id="sw-emp" class="swal2-input" style="margin: 10px 0" placeholder="Empresa">
                <input id="sw-car" class="swal2-input" style="margin: 10px 0" placeholder="Cargo">
                <input id="sw-fec" class="swal2-input" style="margin: 10px 0" placeholder="A√±o Inicio - Fin">
                <textarea id="sw-tar" class="swal2-textarea" style="margin: 10px 0" placeholder="Descripci√≥n de logros..."></textarea>
            `,
            confirmButtonColor: '#007AFF',
            confirmButtonText: 'A√±adir',
            showCancelButton: true,
            cancelButtonText: 'Cancelar',
            preConfirm: () => ({
                emp: document.getElementById('sw-emp').value,
                car: document.getElementById('sw-car').value,
                fec: document.getElementById('sw-fec').value,
                tar: document.getElementById('sw-tar').value
            })
        });
        if (v && v.emp) { cv.exp.push(v); updateList('lista-exp', cv.exp, 'car'); }
    }

    async function modalEdu() {
        const { value: v } = await Swal.fire({
            title: 'A√±adir Educaci√≥n',
            html: `
                <input id="sw-tit" class="swal2-input" style="margin: 10px 0" placeholder="T√≠tulo">
                <input id="sw-uni" class="swal2-input" style="margin: 10px 0" placeholder="Instituci√≥n">
                <input id="sw-fec" class="swal2-input" style="margin: 10px 0" placeholder="A√±os (Ej: 2015-2019)">
            `,
            confirmButtonColor: '#007AFF',
            preConfirm: () => ({
                tit: document.getElementById('sw-tit').value,
                uni: document.getElementById('sw-uni').value,
                fec: document.getElementById('sw-fec').value
            })
        });
        if (v && v.tit) { cv.edu.push(v); updateList('lista-edu', cv.edu, 'tit'); }
    }

    async function modalIdioma() {
        const { value: v } = await Swal.fire({
            title: 'A√±adir Idioma',
            html: `
                <input id="sw-nom" class="swal2-input" placeholder="Ej: Ingl√©s">
                <select id="sw-niv" class="swal2-input">
                    <option value="Nativo">Nativo</option>
                    <option value="Profesional">Profesional</option>
                    <option value="Intermedio">Intermedio</option>
                </select>
            `,
            confirmButtonColor: '#007AFF',
            preConfirm: () => ({ nom: document.getElementById('sw-nom').value, niv: document.getElementById('sw-niv').value })
        });
        if (v && v.nom) { cv.idio.push(v); updateList('lista-idioma', cv.idio, 'nom'); }
    }

    function updateList(id, arr, key) {
        document.getElementById(id).innerHTML = arr.map((item, i) => `
            <div class="item-row fade-in">
                <span><b>${item[key]}</b></span>
                <span class="delete-btn" onclick="removeItem('${id}', ${i})">‚úï</span>
            </div>
        `).join('');
    }

    function removeItem(id, index) {
        const key = id.split('-')[1];
        cv[key].splice(index, 1);
        updateList(id, cv[key], key === 'exp' ? 'car' : (key === 'edu' ? 'tit' : 'nom'));
    }

    // --- L√ìGICA DE EXPORTACI√ìN PROFESIONAL ---
    const { Document, Packer, Paragraph, TextRun, AlignmentType, HeadingLevel, BorderStyle } = docx;

    function generarWord() {
        const doc = new Document({
            sections: [{
                properties: { page: { margin: { top: 720, bottom: 720, left: 720, right: 720 } } },
                children: [
                    // Encabezado Premium
                    new Paragraph({
                        children: [new TextRun({ text: document.getElementById('nombre').value.toUpperCase(), bold: true, size: 52, font: "Arial" })],
                        alignment: AlignmentType.CENTER
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: document.getElementById('cargo').value.toUpperCase(), size: 24, font: "Arial", color: "666666" })],
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 200 }
                    }),
                    new Paragraph({
                        children: [new TextRun({ text: `${document.getElementById('telefono').value}  ‚Ä¢  ${document.getElementById('ubicacion').value}  ‚Ä¢  ${document.getElementById('email').value}`, size: 18 })],
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 400 }
                    }),

                    // Secciones con bordes inferiores (Look Profesional)
                    ...createSection("PERFIL"),
                    new Paragraph({ children: [new TextRun({ text: document.getElementById('perfil').value, size: 21 })], spacing: { after: 300 } }),

                    ...createSection("EXPERIENCIA PROFESIONAL"),
                    ...cv.exp.flatMap(e => [
                        new Paragraph({
                            children: [new TextRun({ text: `${e.emp.toUpperCase()} | ${e.car}`, bold: true, size: 21 })],
                            spacing: { before: 200 }
                        }),
                        new Paragraph({
                            children: [new TextRun({ text: e.fec, italic: true, size: 18, color: "444444" })]
                        }),
                        new Paragraph({ children: [new TextRun({ text: e.tar, size: 20 })], spacing: { after: 100 } })
                    ]),

                    ...createSection("EDUCACI√ìN"),
                    ...cv.edu.flatMap(e => [
                        new Paragraph({
                            children: [new TextRun({ text: `${e.tit} ‚Äî ${e.uni}`, bold: true, size: 21 })]
                        }),
                        new Paragraph({ children: [new TextRun({ text: e.fec, size: 18 })], spacing: { after: 150 } })
                    ]),

                    ...createSection("HABILIDADES & IDIOMAS"),
                    new Paragraph({
                        children: [
                            new TextRun({ text: "HERRAMIENTAS: ", bold: true, size: 20 }),
                            new TextRun({ text: document.getElementById('habilidades').value.split(',').join(' ‚Ä¢ '), size: 20 })
                        ],
                        spacing: { after: 100 }
                    }),
                    ...cv.idio.map(i => new Paragraph({
                        children: [new TextRun({ text: `‚Ä¢ ${i.nom}: ${i.niv}`, size: 20 })]
                    }))
                ]
            }]
        });

        Packer.toBlob(doc).then(blob => {
            saveAs(blob, `CV_${document.getElementById('nombre').value.replace(" ", "_")}.docx`);
            Swal.fire('¬°√âxito!', 'Tu Word se ha generado correctamente', 'success');
        });
    }

    function createSection(title) {
        return [
            new Paragraph({
                children: [new TextRun({ text: title, bold: true, size: 24, font: "Arial", color: "007AFF" })],
                border: { bottom: { color: "007AFF", space: 1, style: BorderStyle.SINGLE, size: 6 } },
                spacing: { before: 400, after: 100 }
            })
        ];
    }

    function generarPDF() {
        Swal.fire({ title: 'Generando PDF...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
        const element = document.querySelector('.app-container');
        const opt = { 
            margin: 10, filename: 'Curriculum_Pro.pdf', 
            html2canvas: { scale: 3 }, 
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } 
        };
        html2pdf().from(element).set(opt).save().then(() => Swal.close());
    }

    // PWA Manifest Din√°mico
    const manifest = {
        name: "CV Studio Pro", short_name: "CVStudio", start_url: ".", display: "standalone",
        background_color: "#F2F2F7", theme_color: "#007AFF",
        icons: [{ src: "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='25' fill='%23007AFF'/><path d='M30 35h40M30 50h40M30 65h25' stroke='white' stroke-width='8' stroke-linecap='round'/></svg>", sizes: "512x512", type: "image/svg+xml" }]
    };
    document.getElementById('pwa-manifest').setAttribute('href', 'data:application/json;base64,' + btoa(JSON.stringify(manifest)));
</script>

</body>
</html>
